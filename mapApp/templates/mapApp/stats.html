{% extends "mapApp/base.html" %}
{% load staticfiles %}


{% block title %}
	Monthly statistics
{% endblock %}


{% block headerCSS %}
	<!-- Load leaflet -->
	<link rel="stylesheet" href="{% static 'leaflet/leaflet.css' %}"/>
{% endblock %}


{% block headerJS %}
    <!-- d3 v3.4.8 -->
    <script src="{% static 'd3/d3.min.js' %}" charset="utf-8"></script>
    
    <!-- Load leaflet -->
    <script src="{% static 'leaflet/leaflet.js' %}"></script>

    <!-- Load marker clustering -->
    <script src="{% static 'leaflet/plugins/leaflet.markercluster/leaflet.markercluster-src.js' %}"></script>

    <!-- Load Maki Markers Icons -->
    <script src="{% static 'leaflet/plugins/maki-markers/Leaflet.MakiMarkers.js' %}"></script>

    <!-- Load heatmap -->
    <script src="{% static 'leaflet/plugins/leaflet-heat/leaflet-heat.js' %}"></script>

    <!-- map generating code -->
    <script src="{% static 'mapApp/js/map.js' %}" charset="utf-8"></script>
    <script src="{% static 'mapApp/js/stats.js' %}" charset="utf-8"></script>
{% endblock %}


{% block body %}
	<div class="container">
		<!-- PLANNED LAYOUT -->
		<!-- Map of one month of reports -->
		<div class="row">
			<div class="col-xs-12">
				<div id="statsMap"></div>
			</div>
		</div>

		<!-- Bar graph of Alert area points by type -->
		<!-- See http://bost.ocks.org/mike/bar/ for bar chart tutorials -->
		<div class="row">
			<div class="col-xs-offset-0 col-xs-12 col-sm-offset-1 col-sm-10 col-md-offset-2 col-md-8">
				<svg id="barchart" width='100%' height='100%'></svg>
			</div>
		</div>


	</div>
	
	<style>
	#barchart text {
	  fill: white;
	  font: 10px sans-serif;
	  text-anchor: start;
	}

	.axis text {
	  font: 10px sans-serif;
	}

	.axis path,
	.axis line {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}
	</style>

	<script>
		// Create dataset out of django context
		// Note, data and counts are for last month of points in user alert areas only, not total points
		var data = [ 
			{ type: "collision", 	value: {{ collisionsCount }}, 	color: "#" + icons["bikeRedIcon"].options.color }, 
			{ type: "nearmiss", 	value: {{ nearmissesCount }}, 	color: "#" + icons["bikeYellowIcon"].options.color }, 
			{ type: "hazard", 		value: {{ hazardsCount }}, 		color: "#" + icons["hazardIcon"].options.color }, 
			{ type: "theft", 		value: {{ theftsCount }}, 		color: "#" + icons["theftIcon"].options.color }
		];

		initializeBarChart(data);

	</script>


	<!-- Longterm: fancier graphs that monitor change -->

{% endblock %}